<!DOCTYPE html><html lang="ko-KR" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="일 전"><meta name="hour-prompt" content="시간 전"><meta name="minute-prompt" content="분 전"><meta name="justnow-prompt" content="방금"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="SSR 환경에서의 React Query" /><meta name="author" content="박 찬영" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="프론트엔드 엔지니어 박찬영입니다." /><meta property="og:description" content="프론트엔드 엔지니어 박찬영입니다." /><link rel="canonical" href="https://univdev.github.io/posts/react-query-ssr/" /><meta property="og:url" content="https://univdev.github.io/posts/react-query-ssr/" /><meta property="og:site_name" content="Univdev" /><meta property="og:image" content="https://univdev.github.io/assets/post_images/2023-01-16-react-query-ssr/20230116184315.png" /><meta property="og:image:alt" content="SSR 환경에서의 React Query" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-16T17:00:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://univdev.github.io/assets/post_images/2023-01-16-react-query-ssr/20230116184315.png" /><meta name="twitter:image:alt" content="SSR 환경에서의 React Query" /><meta property="twitter:title" content="SSR 환경에서의 React Query" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@박 찬영" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"박 찬영"},"dateModified":"2023-09-29T03:01:54+08:00","datePublished":"2023-01-16T17:00:00+08:00","description":"프론트엔드 엔지니어 박찬영입니다.","headline":"SSR 환경에서의 React Query","image":{"alt":"SSR 환경에서의 React Query","url":"https://univdev.github.io/assets/post_images/2023-01-16-react-query-ssr/20230116184315.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://univdev.github.io/posts/react-query-ssr/"},"url":"https://univdev.github.io/posts/react-query-ssr/"}</script><title>SSR 환경에서의 React Query | Univdev</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Univdev"><meta name="application-name" content="Univdev"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css"> <script src="https://unpkg.com/applause-button/dist/applause-button.js"></script> <script src="https://giscus.app/client.js" data-repo="univdev/univdev.github.io" data-repo-id="R_kgDOKFGzfQ" data-category="Comments" data-category-id="DIC_kwDOKFGzfc4CfAOI" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="ko" crossorigin="anonymous" async> </script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/nanumgothic.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-T5JJBHH');</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8120097309829946" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5JJBHH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="sidebar" class="d-flex flex-column align-items-end" lang="ko-KR"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Univdev</a></div><div class="site-subtitle font-italic">프론트엔드 엔지니어 박찬영입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/recommends/" class="nav-link"> <i class="fa-fw fas fa-thumbs-up ml-xl-3 mr-xl-3 unloaded"></i> <span>추천사</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/univdev" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pcydeveloper','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>SSR 환경에서의 React Query</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SSR 환경에서의 React Query</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/univdev">박 찬영</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" date="2023-01-16 17:00:00 +0800" data-toggle="tooltip" data-placement="bottom" title="2023-01-16, 17:00 +0800" >2023년 01월 16일</em> </span> <span> 업데이트 <em class="timeago" date="2023-09-29 04:01:54 +0900 " data-toggle="tooltip" data-placement="bottom" title="2023-09-29, 04:01 +0900" >2023년 09월 29일</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1197 단어"> <em>6 분</em>읽는 시간</span></div></div></div><div class="post-content"><ul id="toc" class="section-nav"><li class="toc-entry toc-h1"><a href="#ssr-환경에서-사용하기">SSR 환경에서 사용하기</a><ul><li class="toc-entry toc-h2"><a href="#solution-1">Solution 1</a><li class="toc-entry toc-h2"><a href="#solution-2">Solution 2</a></ul><li class="toc-entry toc-h1"><a href="#마치며">마치며</a></ul><p><img data-src="/assets/post_images/2023-01-16-react-query-ssr/20230116184315.png" alt="React Query" data-proofer-ignore></p><p>React Query는 서버와 클라이언트 사이에서 데이터를 관리하기 위한 좋은 라이브러리입니다.<br> 자세한 설명은 <a href="/posts/react-query-tutorial/">React Query</a> 문서를 확인 해주세요.</p><h1 id="ssr-환경에서-사용하기"> <a class="anchor" href="#ssr-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>SSR 환경에서 사용하기</h1><p>React Query는 <code class="language-plaintext highlighter-rouge">useQuery</code>라는 <code class="language-plaintext highlighter-rouge">hook</code>을 이용하여 사용하는 점에서 알 수 있듯이 클라이언트 렌더링 때 데이터를 호출하고 관리하는 라이브러리입니다.<br> 그러다보니 웹 서버에 제일 처음 접속하여 수신 받는 HTML 문서에는 <strong>API 호출 이후에 렌더링 되는 데이터들</strong>이 전혀 존재하지 않습니다.<br> 이는 초기 로딩 속도 및 검색 엔진 최적화에서 그다지 바람직하지 않아요.</p><p>이 문제를 해결하기 위해 React Query 공식 페이지에서 알려주는 솔루션에 대해서 소개합니다.</p><h2 id="solution-1"> <a class="anchor" href="#solution-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solution 1 <a href="#solution-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Next.js 환경에서 SSR을 구현하기 위한 보편적인 방법은 <code class="language-plaintext highlighter-rouge">getStaticProps</code> 함수 혹은 <code class="language-plaintext highlighter-rouge">getServerSideProps</code>를 사용하는 것입니다.</p><div class="language-tsx highlighter-rouge"><div class="code-header"> <span data-label-text="Tsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">getServerSideProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">api</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>위 코드를 사용하면 api 라는 Endpoint에 데이터를 호출하여 SSR에서 데이터를 가져온 뒤, props 객체에 데이터를 담아 페이지 렌더링을 진행할 수 있습니다.</p><div class="language-tsx highlighter-rouge"><div class="code-header"> <span data-label-text="Tsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">getData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">api</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">IndexPage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">useQuery</span><span class="p">({</span>
    <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">queryFn</span><span class="p">:</span> <span class="nx">getData</span><span class="p">,</span>
    <span class="na">initialData</span><span class="p">:</span> <span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="c1">// 여기 중요!</span>
  <span class="p">});</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">isSuccess</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span> <span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">getServerSideProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">getData</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">getServerSideProps</code>에서 데이터를 호출한 뒤에 <code class="language-plaintext highlighter-rouge">useQuery</code>의 프로퍼티 중 하나인 <code class="language-plaintext highlighter-rouge">initialData</code>에 데이터를 전달하면 Next.js는 서버에서 불러온 데이터를 기반으로 HTML을 생성하여 기존의 문제점을 해결할 수 있습니다.</p><h2 id="solution-2"> <a class="anchor" href="#solution-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solution 2 <a href="#solution-2" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>가급적 이 방법을 사용하시길 권장합니다.</strong><br> 두 번째 방법은 <code class="language-plaintext highlighter-rouge">dehydrate</code>와 <code class="language-plaintext highlighter-rouge">hydrate</code>를 사용하는 방법입니다.</p><div file="/pages/_app.tsx" class="language-tsx highlighter-rouge"><div class="code-header"> <span data-label-text="/pages/_app.tsx"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">AppProps</span> <span class="p">{</span>
  <span class="nl">dehydratedState</span><span class="p">:</span> <span class="nx">DehydratedState</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">App</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="p">...</span><span class="nx">rest</span> <span class="p">}:</span> <span class="nx">AppPropsWithLayout</span><span class="o">&lt;</span><span class="nx">AppProps</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">Layout</span> <span class="o">=</span> <span class="nx">Component</span><span class="p">.</span><span class="nx">Layout</span> <span class="o">||</span> <span class="p">((</span><span class="nx">page</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">page</span><span class="p">);</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nc">QueryClientProvider</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nc">Hydrate</span> <span class="na">state</span><span class="p">=</span><span class="si">{</span><span class="nx">rest</span><span class="p">.</span><span class="nx">pageProps</span><span class="p">.</span><span class="nx">dehydratedState</span><span class="si">}</span><span class="p">&gt;</span>
        <span class="si">{</span> <span class="nx">Component</span> <span class="si">}</span>
      <span class="p">&lt;/</span><span class="nc">Hydrate</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nc">QueryClientProvider</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span>
</pre></table></code></div></div><p>우선 <code class="language-plaintext highlighter-rouge">/pages/_app.tsx</code> 파일에 <code class="language-plaintext highlighter-rouge">Hydrate</code> Provider를 추가합니다.<br> <code class="language-plaintext highlighter-rouge">pageProps</code> 객체에는 열린 페이지 컴포넌트에 할당 되는 <code class="language-plaintext highlighter-rouge">props</code>가 객체로 전달 되는데, 이 안에 <code class="language-plaintext highlighter-rouge">dehydratedState</code> 라는 값이 포함 될 예정입니다.<br> <code class="language-plaintext highlighter-rouge">dehydratedState</code>를 <code class="language-plaintext highlighter-rouge">Hydrate</code> Provider에 전달합니다.</p><div class="language-tsx highlighter-rouge"><div class="code-header"> <span data-label-text="Tsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">QueryClient</span><span class="p">,</span> <span class="nx">dehydrate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@tanstack/react-query</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">api</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">getServerSideProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">queryClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">QueryClient</span><span class="p">();</span>

  <span class="k">await</span> <span class="nx">queryClient</span><span class="p">.</span><span class="nf">prefetchQuery</span><span class="p">({</span>
    <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">queryFn</span><span class="p">:</span> <span class="nx">getData</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">dehydratedState</span><span class="p">:</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="nx">queryClient</span><span class="p">),</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>이후 데이터가 실제로 호출 되는 하위 페이지에서는 <code class="language-plaintext highlighter-rouge">getServerSideProps</code> 함수 내에서 <code class="language-plaintext highlighter-rouge">QueryClient</code>를 선언한 뒤 <code class="language-plaintext highlighter-rouge">prefetchQuery</code> 메소드를 사용하여 API를 호출합니다.<br> <code class="language-plaintext highlighter-rouge">prefetchQuery</code> 메소드는 <code class="language-plaintext highlighter-rouge">useQuery</code> 메소드와 유사하지만 실제로 데이터를 반환하지는 않고 해당 API에서 넘어온 데이터를 캐싱하는 역할만 합니다.</p><p><code class="language-plaintext highlighter-rouge">dehydratedState</code>는 페이지 컴포넌트의 <code class="language-plaintext highlighter-rouge">props</code>에 할당 되어 <code class="language-plaintext highlighter-rouge">_app.tsx</code> 파일에서 <code class="language-plaintext highlighter-rouge">pageProps</code> 객체로 참조가 가능합니다.<br> Dehydrate된 <code class="language-plaintext highlighter-rouge">QueryClient</code>를 <code class="language-plaintext highlighter-rouge">Hydrate</code>라는 컴포넌트가 CSR을 시작할 때 동일한 Query를 호출하는 부분을 찾아 <code class="language-plaintext highlighter-rouge">initialData</code>에 할당하는 역할을 수행합니다.</p><div class="language-tsx highlighter-rouge"><div class="code-header"> <span data-label-text="Tsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">QueryClient</span><span class="p">,</span> <span class="nx">dehydrate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@tanstack/react-query</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getData</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">api</span><span class="p">).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nf">json</span><span class="p">()).</span><span class="nf">then</span><span class="p">((</span><span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">IndexPage</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">useQuery</span><span class="p">({</span>
    <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">queryFn</span><span class="p">:</span> <span class="nx">getData</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="k">return </span><span class="p">(</span>
    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
      <span class="si">{</span> <span class="nx">data</span><span class="p">.</span><span class="nx">isSuccess</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span> <span class="si">}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">getServerSideProps</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">queryClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">QueryClient</span><span class="p">();</span>

  <span class="k">await</span> <span class="nx">queryClient</span><span class="p">.</span><span class="nf">prefetchQuery</span><span class="p">({</span>
    <span class="na">queryKey</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">data</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">queryFn</span><span class="p">:</span> <span class="nx">getData</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">props</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">dehydratedState</span><span class="p">:</span> <span class="nf">dehydrate</span><span class="p">(</span><span class="nx">queryClient</span><span class="p">),</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>그러면 위와 같이 <code class="language-plaintext highlighter-rouge">initialData</code> 없이 SSR 처리가 가능합니다.</p><h1 id="마치며"> <a class="anchor" href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>마치며</h1><p>SSR 환경에서의 개발을 진행하시다 보면 <code class="language-plaintext highlighter-rouge">hydrate</code>라는 용어를 굉장히 많이 접하실거예요.<br> 이 상황에서 말하는 <code class="language-plaintext highlighter-rouge">hydrate</code>는 대부분 ‘서버에서 만들어진 데이터를 클라이언트에서 활용할 수 있도록 동기화 시켜주는 작업’이라고 생각하시면 될 것 같습니다.<br> <a href="/posts/nextjs-hydration/">이에 대해 작성했던 문서</a>가 있으니 한 번 쯤 읽어주시면 좋을 것 같습니다.</p></div><applause-button class="mb6" color=rgb(79,177,186) url=https://univdev.github.io/posts/react-query-ssr/ > </applause-button><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>Tech</a>, <a href='/categories/react-query/'>React Query</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/react/" class="post-tag no-text-decoration" >React</a> <a href="/tags/next-js/" class="post-tag no-text-decoration" >Next.js</a> <a href="/tags/react-query/" class="post-tag no-text-decoration" >React Query</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=SSR 환경에서의 React Query - Univdev&url=https://univdev.github.io/posts/react-query-ssr/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SSR 환경에서의 React Query - Univdev&u=https://univdev.github.io/posts/react-query-ssr/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=SSR 환경에서의 React Query - Univdev&url=https://univdev.github.io/posts/react-query-ssr/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div><div class="giscus-frame" style="margin-top: 24px"><div class="giscus"></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/adapter-pattern/">서버와 클라이언트의 우아한(?) 대화 방법, Adapter Pattern (Feat. FSD)</a><li><a href="/posts/experience-teacher/">프로그래밍 교육을 진행해보며 느낀점 (멘토 활동 중간 회고)</a><li><a href="/posts/my-first-npm-library/">우아한 나의 패키지, ww-timer 회고</a><li><a href="/posts/2024-seoul-comicworld-ssul/">2024 서울 코믹월드 부스 참여한 썰 풉니다</a><li><a href="/posts/focuskeeper-renewal/">Focus Keeper 랜딩 페이지 런칭 후기 (부제: UX가 프로덕트 성공에 미치는 영향)</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/react-native/">React Native</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/tech/">Tech</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/next-js/">Next.js</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/talk/">Talk</a> <a class="post-tag" href="/tags/vue/">Vue</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/react-query-tutorial/"><div class="card-body"> <em class="timeago small" date="2022-10-25 23:54:00 +0800" >2022년 10월 25일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>React Query로 관리하는 효율적인 서버 데이터 핸들링</h3><div class="text-muted small"><p> React Query React Query는 네트워크에서 받아온 데이터를 관리하기 위해 처리해야 하는 다양하고 번거로운 절차들을 대신 처리해주는 라이브러리입니다. React Query npm 다운로드 횟수 주간 다운로드 횟수가 백만 회를 넘어갈 정도로 인기가 많은 라이브러리인데, 서버 데이터에 대해 어떤 문제점이 있길래 이렇게나 많은 호응을 얻을...</p></div></div></a></div><div class="card"> <a href="/posts/nextjs-hydration/"><div class="card-body"> <em class="timeago small" date="2022-11-03 09:53:00 +0800" >2022년 11월 03일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nextjs의 hydration이란?</h3><div class="text-muted small"><p> Hydration Hydration을 검색하면 나오는 이미지 Hydration은 위 이미지처럼 ‘수분 공급’을 의미합니다. Hydration을 이해하기 전에 CSR, SSR이 무엇인지 간단하게 짚고 넘어가야 합니다. CSR Client Side Rendering의 약자입니다. Web은 단순히 홈페이지라는 개념을 넘어서 응용프로그램의 영역을 대체한지 ...</p></div></div></a></div><div class="card"> <a href="/posts/nextjs-portal/"><div class="card-body"> <em class="timeago small" date="2022-11-03 09:53:00 +0800" >2022년 11월 03일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nextjs에서 React Portal 사용해보기</h3><div class="text-muted small"><p> React Portal 웹을 제작하다보면 대부분의 경우 계층 구조로 컴포넌트를 배치하여 렌더링하는 방식으로 문제를 해결할 수 있습니다. 그런데 간혹 n레벨에 배치 되어야 하는 컴포넌트가 실제로 렌더링 될 때는 Document의 최상단에 배치하고 싶을 수 있습니다. Tooltip Modal Tooltip이나 Modal 컴포넌트가 바로 그 대표적인...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rotate-objects/" class="btn btn-outline-primary" prompt="이전 글"><p>도형의 각도를 회전하는 방법</p></a> <a href="/posts/new-post-tech-blog-pixo/" class="btn btn-outline-primary" prompt="다음 글"><p>기술 블로그 살리기, TF부터 글 작성까지의 일대기</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Univdev</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/react-native/">React Native</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/tech/">Tech</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/next-js/">Next.js</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/talk/">Talk</a> <a class="post-tag" href="/tags/vue/">Vue</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-YG0J6JPJH8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-YG0J6JPJH8'); }); </script> <script type="module"> // Import the functions you need from the SDKs you need import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js"; import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-analytics.js"; // TODO: Add SDKs for Firebase products that you want to use // https://firebase.google.com/docs/web/setup#available-libraries // Your web app's Firebase configuration // For Firebase JS SDK v7.20.0 and later, measurementId is optional const firebaseConfig = { apiKey: "AIzaSyBJNPjzcl0MfmOnqKAPv_DxEKE9BTtXatQ", authDomain: "univdev-github-io.firebaseapp.com", projectId: "univdev-github-io", storageBucket: "univdev-github-io.appspot.com", messagingSenderId: "259575315621", appId: "1:259575315621:web:c6a4b474e982f56f65a14c", measurementId: "G-Z60972D1V1" }; // Initialize Firebase const app = initializeApp(firebaseConfig); const analytics = getAnalytics(app); </script>
