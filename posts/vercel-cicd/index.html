<!DOCTYPE html><html lang="ko-KR" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="일 전"><meta name="hour-prompt" content="시간 전"><meta name="minute-prompt" content="분 전"><meta name="justnow-prompt" content="방금"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화" /><meta name="author" content="박 찬영" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="안녕하세요 😁 박찬영입니다. 오늘은 Next.js와 Vercel을 활용한 배포 자동화 방법에 대해서 얘기 하고자 해요. 이번에 제가 회사에서 진행하고 있었던 프로젝트가 AWS에서 Vercel로 인프라를 이전하게 되었어요. 그러한 이유로 AWS의 CI/CD를 사용할 수가 없기 때문에 Vercel에 맞는 자동 배포를 구성할 할 필요가 있어 이번 Task를 진행하게 되었습니다. CI/CD란? 현업에서 활약하고 계신 분들은 당연하고 개발자를 지망하시는 분들도 CI/CD에 대해서는 한번 쯤 들어보신 적이 있으실거예요. CI/CD는 Continuous Integration와 Continuous Delivery의 약자를 결합한 단어입니다. 간단하게 말해서 “지속적으로 통합하고 지속적으로 배포해라”입니다. CI CI는 이처럼 개발자가 개발한 프로젝트를 빌드하고 테스트를 진행하는 일련의 프로세스를 말해요. 여러 개발자들이 하나의 프로젝트에서 동시적인 개발을 진행하게 되면 분명히 높은 확률로 충돌 등이 일어나게 되는데 잘 짜여진 CI는 이러한 상황을 미연에 방지해줘요. CD CD는 지속적으로 고객에게 프로젝트를 전달하기 위한 프로세스를 말해요. 여기서 말하는 고객은 최종 사용자가 될 수도 있고, 조직 내부의 QA팀이 될 수도 있어요. 배포는 하루에도 수 없이 발생할 수 있는 중요한 과정이며, 또한 매우 귀찮고 시간을 많이 잡아먹는 작업이에요. 이 작업을 자동화 하는 것이 CD의 핵심이라고 할 수 있어요. 왜 배포를 자동화 해야 할까요? 개발자가 Staging 혹은 Production 서버에 결과물을 배포하는 과정에는 다음과 같아요. Local Server에서 개발을 열심히 진행합니다. Build 커맨드를 입력하여 실제로 오류 없이 Build가 동작 하는지 시험 해봅니다. Test 커맨드를 입력하여 테스트를 진행합니다. 위 과정에서 문제가 없었다면 웹(혹은 서버) 호스팅 서비스에 Terminal을 사용하여 접속합니다. git pull 명령어를 이용하여 원격 서버의 프로젝트 파일을 최신화 합니다. Build 커맨드를 입력하여 실제로 사용할 파일을 만듭니다. Build 된 파일을 실행합니다. 유관자에게 새로운 버전이 배포 되었다는 사실을 알립니다. 만약 배포 이후에 버그가 발견 되었다면 1번으로 돌아가서 이 과정을 다시 수행해야 합니다." /><meta property="og:description" content="안녕하세요 😁 박찬영입니다. 오늘은 Next.js와 Vercel을 활용한 배포 자동화 방법에 대해서 얘기 하고자 해요. 이번에 제가 회사에서 진행하고 있었던 프로젝트가 AWS에서 Vercel로 인프라를 이전하게 되었어요. 그러한 이유로 AWS의 CI/CD를 사용할 수가 없기 때문에 Vercel에 맞는 자동 배포를 구성할 할 필요가 있어 이번 Task를 진행하게 되었습니다. CI/CD란? 현업에서 활약하고 계신 분들은 당연하고 개발자를 지망하시는 분들도 CI/CD에 대해서는 한번 쯤 들어보신 적이 있으실거예요. CI/CD는 Continuous Integration와 Continuous Delivery의 약자를 결합한 단어입니다. 간단하게 말해서 “지속적으로 통합하고 지속적으로 배포해라”입니다. CI CI는 이처럼 개발자가 개발한 프로젝트를 빌드하고 테스트를 진행하는 일련의 프로세스를 말해요. 여러 개발자들이 하나의 프로젝트에서 동시적인 개발을 진행하게 되면 분명히 높은 확률로 충돌 등이 일어나게 되는데 잘 짜여진 CI는 이러한 상황을 미연에 방지해줘요. CD CD는 지속적으로 고객에게 프로젝트를 전달하기 위한 프로세스를 말해요. 여기서 말하는 고객은 최종 사용자가 될 수도 있고, 조직 내부의 QA팀이 될 수도 있어요. 배포는 하루에도 수 없이 발생할 수 있는 중요한 과정이며, 또한 매우 귀찮고 시간을 많이 잡아먹는 작업이에요. 이 작업을 자동화 하는 것이 CD의 핵심이라고 할 수 있어요. 왜 배포를 자동화 해야 할까요? 개발자가 Staging 혹은 Production 서버에 결과물을 배포하는 과정에는 다음과 같아요. Local Server에서 개발을 열심히 진행합니다. Build 커맨드를 입력하여 실제로 오류 없이 Build가 동작 하는지 시험 해봅니다. Test 커맨드를 입력하여 테스트를 진행합니다. 위 과정에서 문제가 없었다면 웹(혹은 서버) 호스팅 서비스에 Terminal을 사용하여 접속합니다. git pull 명령어를 이용하여 원격 서버의 프로젝트 파일을 최신화 합니다. Build 커맨드를 입력하여 실제로 사용할 파일을 만듭니다. Build 된 파일을 실행합니다. 유관자에게 새로운 버전이 배포 되었다는 사실을 알립니다. 만약 배포 이후에 버그가 발견 되었다면 1번으로 돌아가서 이 과정을 다시 수행해야 합니다." /><link rel="canonical" href="https://univdev.github.io/posts/vercel-cicd/" /><meta property="og:url" content="https://univdev.github.io/posts/vercel-cicd/" /><meta property="og:site_name" content="Univdev" /><meta property="og:image" content="https://univdev.github.io/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-57-09.png" /><meta property="og:image:alt" content="Next.js + Vercel 가장 아름다운 배포 자동화" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-09-29T22:21:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://univdev.github.io/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-57-09.png" /><meta name="twitter:image:alt" content="Next.js + Vercel 가장 아름다운 배포 자동화" /><meta property="twitter:title" content="Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@박 찬영" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"박 찬영"},"dateModified":"2023-09-29T22:21:00+08:00","datePublished":"2023-09-29T22:21:00+08:00","description":"안녕하세요 😁 박찬영입니다. 오늘은 Next.js와 Vercel을 활용한 배포 자동화 방법에 대해서 얘기 하고자 해요. 이번에 제가 회사에서 진행하고 있었던 프로젝트가 AWS에서 Vercel로 인프라를 이전하게 되었어요. 그러한 이유로 AWS의 CI/CD를 사용할 수가 없기 때문에 Vercel에 맞는 자동 배포를 구성할 할 필요가 있어 이번 Task를 진행하게 되었습니다. CI/CD란? 현업에서 활약하고 계신 분들은 당연하고 개발자를 지망하시는 분들도 CI/CD에 대해서는 한번 쯤 들어보신 적이 있으실거예요. CI/CD는 Continuous Integration와 Continuous Delivery의 약자를 결합한 단어입니다. 간단하게 말해서 “지속적으로 통합하고 지속적으로 배포해라”입니다. CI CI는 이처럼 개발자가 개발한 프로젝트를 빌드하고 테스트를 진행하는 일련의 프로세스를 말해요. 여러 개발자들이 하나의 프로젝트에서 동시적인 개발을 진행하게 되면 분명히 높은 확률로 충돌 등이 일어나게 되는데 잘 짜여진 CI는 이러한 상황을 미연에 방지해줘요. CD CD는 지속적으로 고객에게 프로젝트를 전달하기 위한 프로세스를 말해요. 여기서 말하는 고객은 최종 사용자가 될 수도 있고, 조직 내부의 QA팀이 될 수도 있어요. 배포는 하루에도 수 없이 발생할 수 있는 중요한 과정이며, 또한 매우 귀찮고 시간을 많이 잡아먹는 작업이에요. 이 작업을 자동화 하는 것이 CD의 핵심이라고 할 수 있어요. 왜 배포를 자동화 해야 할까요? 개발자가 Staging 혹은 Production 서버에 결과물을 배포하는 과정에는 다음과 같아요. Local Server에서 개발을 열심히 진행합니다. Build 커맨드를 입력하여 실제로 오류 없이 Build가 동작 하는지 시험 해봅니다. Test 커맨드를 입력하여 테스트를 진행합니다. 위 과정에서 문제가 없었다면 웹(혹은 서버) 호스팅 서비스에 Terminal을 사용하여 접속합니다. git pull 명령어를 이용하여 원격 서버의 프로젝트 파일을 최신화 합니다. Build 커맨드를 입력하여 실제로 사용할 파일을 만듭니다. Build 된 파일을 실행합니다. 유관자에게 새로운 버전이 배포 되었다는 사실을 알립니다. 만약 배포 이후에 버그가 발견 되었다면 1번으로 돌아가서 이 과정을 다시 수행해야 합니다.","headline":"Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화","image":{"alt":"Next.js + Vercel 가장 아름다운 배포 자동화","url":"https://univdev.github.io/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-57-09.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://univdev.github.io/posts/vercel-cicd/"},"url":"https://univdev.github.io/posts/vercel-cicd/"}</script><title>Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화 | Univdev</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Univdev"><meta name="application-name" content="Univdev"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="stylesheet" href="https://unpkg.com/applause-button/dist/applause-button.css"> <script src="https://unpkg.com/applause-button/dist/applause-button.js"></script> <script src="https://giscus.app/client.js" data-repo="univdev/univdev.github.io" data-repo-id="R_kgDOKFGzfQ" data-category="Comments" data-category-id="DIC_kwDOKFGzfc4CfAOI" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="ko" crossorigin="anonymous" async> </script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/nanumgothic.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-T5JJBHH');</script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8120097309829946" crossorigin="anonymous"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T5JJBHH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="sidebar" class="d-flex flex-column align-items-end" lang="ko-KR"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Univdev</a></div><div class="site-subtitle font-italic">프론트엔드 엔지니어 박찬영입니다.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/recommends/" class="nav-link"> <i class="fa-fw fas fa-thumbs-up ml-xl-3 mr-xl-3 unloaded"></i> <span>추천사</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/univdev" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pcydeveloper','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/univdev">박 찬영</a> </em></div><div class="d-flex"><div> <span> 게시 <em class="timeago" date="2023-09-29 22:21:00 +0800" data-toggle="tooltip" data-placement="bottom" title="2023-09-29, 22:21 +0800" >2023년 09월 29일</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="5804 단어"> <em>32 분</em>읽는 시간</span></div></div></div><div class="post-content"><ul id="toc" class="section-nav"><li class="toc-entry toc-h1"><a href="#cicd란">CI/CD란?</a><ul><li class="toc-entry toc-h2"><a href="#ci">CI</a><li class="toc-entry toc-h2"><a href="#cd">CD</a><li class="toc-entry toc-h2"><a href="#왜-배포를-자동화-해야-할까요">왜 배포를 자동화 해야 할까요?</a></ul><li class="toc-entry toc-h1"><a href="#vercel">Vercel</a><ul><li class="toc-entry toc-h2"><a href="#vercel의-운영-환경-이해하기">Vercel의 운영 환경 이해하기</a><ul><li class="toc-entry toc-h3"><a href="#development">Development</a><li class="toc-entry toc-h3"><a href="#preview">Preview</a><li class="toc-entry toc-h3"><a href="#production">Production</a></ul></ul><li class="toc-entry toc-h1"><a href="#프로젝트-추가">프로젝트 추가</a><ul><li class="toc-entry toc-h2"><a href="#vercel-cli를-이용한-프로젝트-추가">Vercel CLI를 이용한 프로젝트 추가</a><li class="toc-entry toc-h2"><a href="#nextjs-환경을-위한-배포-명령어-설정">Next.js 환경을 위한 배포 명령어 설정</a><ul><li class="toc-entry toc-h3"><a href="#build-command">Build Command</a><li class="toc-entry toc-h3"><a href="#development-command">Development Command</a><li class="toc-entry toc-h3"><a href="#install-command">Install Command</a><li class="toc-entry toc-h3"><a href="#output-directory">Output Directory</a></ul></ul><li class="toc-entry toc-h1"><a href="#vercel-프로젝트-설정">Vercel 프로젝트 설정</a><ul><li class="toc-entry toc-h2"><a href="#개설한-프로젝트-진입하기">개설한 프로젝트 진입하기</a><li class="toc-entry toc-h2"><a href="#자동배포-차단하기">자동배포 차단하기</a><ul><li class="toc-entry toc-h3"><a href="#자동-배포를-차단해야-하는-이유">자동 배포를 차단해야 하는 이유</a><li class="toc-entry toc-h3"><a href="#방법">방법</a></ul><li class="toc-entry toc-h2"><a href="#staging-도메인-개설하기">Staging 도메인 개설하기</a><li class="toc-entry toc-h2"><a href="#환경변수-설정하기">환경변수 설정하기</a></ul><li class="toc-entry toc-h1"><a href="#github-workflow를-이용한-cicd">Github Workflow를 이용한 CI/CD</a><ul><li class="toc-entry toc-h2"><a href="#vercel-환경-변수-알아내기">Vercel 환경 변수 알아내기</a><ul><li class="toc-entry toc-h3"><a href="#organization-id">Organization ID</a><li class="toc-entry toc-h3"><a href="#project-id">Project ID</a><li class="toc-entry toc-h3"><a href="#token">Token</a><li class="toc-entry toc-h3"><a href="#team-id">Team ID</a></ul><li class="toc-entry toc-h2"><a href="#github-secret-key-등록하기">Github Secret Key 등록하기</a><li class="toc-entry toc-h2"><a href="#github-디렉토리-만들기">.github 디렉토리 만들기</a><li class="toc-entry toc-h2"><a href="#preview-배포-자동화-스크립트-작성하기">Preview 배포 자동화 스크립트 작성하기</a><li class="toc-entry toc-h2"><a href="#preview-배포-스크립트-이해하기">Preview 배포 스크립트 이해하기</a><ul><li class="toc-entry toc-h3"><a href="#-왜-alias가-필요한가요">❓ 왜 alias가 필요한가요?</a></ul><li class="toc-entry toc-h2"><a href="#production-배포-자동화-스크립트-작성하기">Production 배포 자동화 스크립트 작성하기</a><li class="toc-entry toc-h2"><a href="#production-배포-스크립트-이해하기">Production 배포 스크립트 이해하기</a></ul><li class="toc-entry toc-h1"><a href="#마치며">마치며</a></ul><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-57-09.png" alt="Next.js + Vercel 가장 아름다운 배포 자동화" data-proofer-ignore><br> 안녕하세요 😁 박찬영입니다.<br> 오늘은 Next.js와 Vercel을 활용한 배포 자동화 방법에 대해서 얘기 하고자 해요.<br> 이번에 제가 회사에서 진행하고 있었던 프로젝트가 AWS에서 Vercel로 인프라를 이전하게 되었어요.<br> 그러한 이유로 AWS의 CI/CD를 사용할 수가 없기 때문에 Vercel에 맞는 자동 배포를 구성할 할 필요가 있어 이번 Task를 진행하게 되었습니다.</p><h1 id="cicd란"> <a class="anchor" href="#cicd%EB%9E%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>CI/CD란?</h1><p>현업에서 활약하고 계신 분들은 당연하고 개발자를 지망하시는 분들도 CI/CD에 대해서는 한번 쯤 들어보신 적이 있으실거예요.<br> CI/CD는 Continuous Integration와 Continuous Delivery의 약자를 결합한 단어입니다.<br> 간단하게 말해서 <em>“지속적으로 통합하고 지속적으로 배포해라”</em>입니다.</p><h2 id="ci"> <a class="anchor" href="#ci" aria-hidden="true"><span class="octicon octicon-link"></span></a>CI <a href="#ci" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-29-23-49-03.png" alt="CI 프로세스" data-proofer-ignore><br> CI는 이처럼 개발자가 개발한 프로젝트를 빌드하고 테스트를 진행하는 일련의 프로세스를 말해요.<br> 여러 개발자들이 하나의 프로젝트에서 동시적인 개발을 진행하게 되면 분명히 높은 확률로 충돌 등이 일어나게 되는데 잘 짜여진 CI는 이러한 상황을 미연에 방지해줘요.</p><h2 id="cd"> <a class="anchor" href="#cd" aria-hidden="true"><span class="octicon octicon-link"></span></a>CD <a href="#cd" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-29-23-56-05.png" alt="CD 프로세스" data-proofer-ignore><br> CD는 지속적으로 고객에게 프로젝트를 전달하기 위한 프로세스를 말해요.<br> 여기서 말하는 고객은 최종 사용자가 될 수도 있고, 조직 내부의 QA팀이 될 수도 있어요.<br> 배포는 하루에도 수 없이 발생할 수 있는 중요한 과정이며, 또한 매우 귀찮고 시간을 많이 잡아먹는 작업이에요.<br> 이 작업을 자동화 하는 것이 CD의 핵심이라고 할 수 있어요.</p><h2 id="왜-배포를-자동화-해야-할까요"> <a class="anchor" href="#%EC%99%9C-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%9E%90%EB%8F%99%ED%99%94-%ED%95%B4%EC%95%BC-%ED%95%A0%EA%B9%8C%EC%9A%94" aria-hidden="true"><span class="octicon octicon-link"></span></a>왜 배포를 자동화 해야 할까요? <a href="#왜-배포를-자동화-해야-할까요" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-09-51.png" alt="왜 배포 자동화를 해야 할까요?" data-proofer-ignore><br> 개발자가 Staging 혹은 Production 서버에 결과물을 배포하는 과정에는 다음과 같아요.</p><ol><li>Local Server에서 개발을 열심히 진행합니다.<li>Build 커맨드를 입력하여 실제로 오류 없이 Build가 동작 하는지 시험 해봅니다.<li>Test 커맨드를 입력하여 테스트를 진행합니다.<li>위 과정에서 문제가 없었다면 웹(혹은 서버) 호스팅 서비스에 Terminal을 사용하여 접속합니다.<li> <code class="language-plaintext highlighter-rouge">git pull</code> 명령어를 이용하여 원격 서버의 프로젝트 파일을 최신화 합니다.<li>Build 커맨드를 입력하여 실제로 사용할 파일을 만듭니다.<li>Build 된 파일을 실행합니다.<li>유관자에게 새로운 버전이 배포 되었다는 사실을 알립니다.<li>만약 배포 이후에 버그가 발견 되었다면 <strong>1번으로 돌아가서 이 과정을 다시 수행해야 합니다.</strong></ol><p>이 과정은 글로 나열만 해도 벌써부터 피곤함이 느껴집니다 🤮 실제로는 이보다 더 악랄하겠죠.<br> 규모가 큰 프로젝트에서의 Build 시간만 따져봐도 10분이 넘는 경우도 있거든요.<br> 이 과정을 자동화 한다면 개발자는 Git에 새로운 커밋 하나를 올리거나, 배포 버튼을 누르는 간단한 작업 하나만으로 이 모든 작업에서 자유로워질 수 있어요.<br> 배포 자동화의 중요성을 이제 잘 아시겠죠?</p><h1 id="vercel"> <a class="anchor" href="#vercel" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vercel</h1><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-28-25.png" alt="Vercel" data-proofer-ignore><br> 우선 배포 자동화를 진행하기 전에 이번에 사용한 Vercel에 대해서 짧게 핥아보고 갈 필요가 있어요.<br> <a href="https://vercel.com/">Vercel</a>은 Next.js 혹은 React를 이용하여 만들어진 프로젝트를 배포하는데 최적화 된 솔루션입니다.<br> Vercel의 특징이자 가장 큰 장점은 다음과 같습니다.</p><ul><li>Zero Config을 지향하기 때문에 AWS같은 솔루션과는 비교가 안될 정도로 초기 설정이 단순합니다.<li>Next.js의 개발사이다 보니 React와 Next.js에 관한 배포와 최적화는 타 플랫폼과 비교가 불가능합니다.<ul><li>폰트 최적화<li>이미지 최적화 및 캐싱<li>Edge Function 등</ul></ul><h2 id="vercel의-운영-환경-이해하기"> <a class="anchor" href="#vercel%EC%9D%98-%EC%9A%B4%EC%98%81-%ED%99%98%EA%B2%BD-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vercel의 운영 환경 이해하기 <a href="#vercel의-운영-환경-이해하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Vercel은 세 가지의 배포 환경이 존재합니다.</p><h3 id="development"> <a class="anchor" href="#development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Development <a href="#development" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">vercel dev</code>를 로컬 환경에서 실행했을 때 Development 환경으로 구동 됩니다.</p><ul><li>Vercel이 지원하는 <code class="language-plaintext highlighter-rouge">dev</code> 명령어는 <code class="language-plaintext highlighter-rouge">Vercel</code>의 환경을 다운로드 받아 개발모드로 실행하도록 해주는 명령어입니다.<li>Vercel에 등록 된 모든 설정값과 개발 모드에서 불러올 수 있는 환경 변수를 적용한 상태로 로컬 환경에서 체험할 수 있습니다.</ul><h3 id="preview"> <a class="anchor" href="#preview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preview <a href="#preview" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>일반적인 <code class="language-plaintext highlighter-rouge">staging</code>의 역할을 하는 환경입니다.<li> <code class="language-plaintext highlighter-rouge">master</code> 혹은 <code class="language-plaintext highlighter-rouge">main</code> 이라는 이름을 가진 브랜치 외 나머지 브랜치에 히스토리가 추가 되면 자동으로 배포 됩니다.<li> <code class="language-plaintext highlighter-rouge">vercel deploy --prebuilt</code> 명령어로 직접 배포할 수도 있습니다.<li>Preview는 배포가 이루어질 때마다 새로운 형태의 도메인이 새로 발급 됩니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-32-48.png" alt="Preview 히스토리" data-proofer-ignore><li>이전 버전의 Preview 도메인이 스냅샷처럼 남아있기에 과거 버전과 현재 버전을 따로 접속해서 열람하는 것도 가능합니다.</ul><h3 id="production"> <a class="anchor" href="#production" aria-hidden="true"><span class="octicon octicon-link"></span></a>Production <a href="#production" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>실제 사용자에게 전달 될 서비스입니다.<li> <code class="language-plaintext highlighter-rouge">master</code> 혹은 <code class="language-plaintext highlighter-rouge">main</code> 이라는 이름을 가진 브랜치에 새로운 히스토리가 추가 되면 배포 됩니다.<li> <code class="language-plaintext highlighter-rouge">vercel deploy</code> 명령어로 직접 배포할 수도 있습니다.</ul><h1 id="프로젝트-추가"> <a class="anchor" href="#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%B6%94%EA%B0%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>프로젝트 추가</h1><h2 id="vercel-cli를-이용한-프로젝트-추가"> <a class="anchor" href="#vercel-cli%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%B6%94%EA%B0%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vercel CLI를 이용한 프로젝트 추가 <a href="#vercel-cli를-이용한-프로젝트-추가" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li><p>npm을 이용하여 Vercel CLI를 설치합니다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> npm i <span class="nt">-g</span> vercel
</pre></table></code></div></div><li><p>Vercel 로그인을 진행합니다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> vercel login
</pre></table></code></div></div><li><p>Vercel로 호스팅 하고자 하는 프로젝트의 Root에서 아래의 명령어를 입력합니다.</p><aside> ⚠️ 현재 프로젝트의 구조가 Monorepo라도 package 폴더 내부가 아닌 Monorepo 레포지토리 최상위 폴더에서 사용해야 합니다.</aside><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> vercel <span class="nb">link</span>
</pre></table></code></div></div><li><p>위 명령어를 사용하면 Vercel 프로젝트와 Git Repository를 연결하는 작업을 시작합니다.</p><ol><li><p>현재 디렉토리에 Vercel 설정을 진행하는지 묻습니다. Y를 입력해주세요.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> <span class="c"># 현재 디렉토리에 Vercel 설정을 진행합니까?</span>
 ? Set up “~/repository-path”? <span class="o">[</span>Y/n]: Y
</pre></table></code></div></div><li><p>해당 프로젝트의 scope를 설정 해주세요.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="c"># 해당 프로젝트의 scope를 설정 해주세요.</span>
 ? Which scope should contain your project?
   <span class="o">[</span> <span class="o">]</span> organization1
 	<span class="o">[</span> <span class="o">]</span> organization2
 	<span class="o">[</span> <span class="o">]</span> organization3
</pre></table></code></div></div><ul><li>Vercel과 연결 된 계정에 포함 된 모든 조직이 나옵니다.<li>이 프로젝트를 소유할 조직을 선택하시면 됩니다.</ul><li><p>Vercel 프로젝트의 생성 혹은 연결 여부를 결정합니다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre> <span class="c"># Vercel에 이미 프로젝트가 생성 되어 있고, 해당 프로젝트의 설정값을 그대로</span>
 <span class="c"># 연결하길 원하면 Y를 입력합니다.</span>
 ? Link to existing project? <span class="o">[</span>y/N]:
</pre></table></code></div></div><ul><li>만약 Vercel에 이미 존재하는 프로젝트와 연결하는 경우 Y를 입력해주세요.<li>프로젝트 설정을 마저 진행하시려면 N을 입력해주세요.</ul><li><p>Vercel 프로젝트의 이름을 입력해주세요.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre> <span class="c"># 이 프로젝트와 연결 될 Vercel 프로젝트의 이름을 입력합니다. (입력한 이름대로 생성 됩니다.)</span>
 ? What<span class="s1">'s your project'</span>s name?
</pre></table></code></div></div><li><p>배포가 이루어질 프로젝트의 경로를 입력합니다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> <span class="c"># Vercel을 통해 배포를 진행할 패키지의 Root 디렉토리를 입력합니다.</span>
 <span class="c"># 모놀리식 프로젝트라면 기본값인 ./를 사용하면 됩니다.</span>
 <span class="c"># 모노레포 프로젝트라면 packages/web과 같은 배포할 패키지의 상대 경로를 입력해야 합니다.</span>
 ? In which directory is your code located? ./
</pre></table></code></div></div><ul><li>일반적인 단일레포(모놀리식)의 경우 기본값인 <code class="language-plaintext highlighter-rouge">./</code>대로 설정하셔도 무방합니다.<li>만약 모노레포라면 실제 Vercel을 이용하여 배포를 진행할 프로젝트가 저장된 곳의 상대 경로를 입력합니다.<li>만약 <code class="language-plaintext highlighter-rouge">packages/web</code>에 있는 패키지만 Vercel을 이용하여 호스팅 하려면 <code class="language-plaintext highlighter-rouge">packages/web</code>을 입력합니다.</ul></ol><p>f. 배포 명령어를 설정합니다.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> <span class="c"># 위에서 입력한 여러 설정값을 바탕으로 Vercel의 배포 프로세스에서 사용할 명령어를 설정합니다.</span>
 <span class="c"># Build Command는 일반적으로 사용하고 있는 프로젝트 빌드를 위한 커맨드 입니다.</span>
 <span class="c"># Development Command는 개발모드 설정을 위한 커맨드 입니다.</span>
 <span class="c"># Output Directory는 빌드 이후에 배포 될 파일들이 추가 되는 폴더입니다.</span>
 No framework detected. Default Project Settings:
 - Build Command: <span class="sb">`</span>npm run vercel-build<span class="sb">`</span> or <span class="sb">`</span>npm run build<span class="sb">`</span>
 - Development Command: None
 - Install Command: <span class="sb">`</span>yarn <span class="nb">install</span><span class="sb">`</span>, <span class="sb">`</span>pnpm <span class="nb">install</span><span class="sb">`</span>, <span class="sb">`</span>npm <span class="nb">install</span><span class="sb">`</span>, or <span class="sb">`</span>bun <span class="nb">install</span><span class="sb">`</span>
 - Output Directory: <span class="sb">`</span>public<span class="sb">`</span> <span class="k">if </span>it exists, or <span class="sb">`</span>.<span class="sb">`</span>
 ? Want to modify these settings? <span class="o">[</span>y/N]
</pre></table></code></div></div><ul><li>Build Command는 프로젝트를 빌드할 때 사용하는 명령어입니다.<li>Development Command는 개발모드 실행을 위해 사용하는 명령어입니다.<li>Install Command는 패키지를 설치할 때 사용하는 명령어입니다.<li>Output Directory는 빌드 이후 번들링 된 파일들이 저장 될 경로입니다.</ul></ol><h2 id="nextjs-환경을-위한-배포-명령어-설정"> <a class="anchor" href="#nextjs-%ED%99%98%EA%B2%BD%EC%9D%84-%EC%9C%84%ED%95%9C-%EB%B0%B0%ED%8F%AC-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%84%A4%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>Next.js 환경을 위한 배포 명령어 설정 <a href="#nextjs-환경을-위한-배포-명령어-설정" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>개발 된 프로젝트가 Next.js로 만들어져 있다면 위 설정 과정 중 ‘배포 명령어 설정 과정’에서 일부 값을 변경해야 합니다.</p><h3 id="build-command"> <a class="anchor" href="#build-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build Command <a href="#build-command" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>특별한 일이 없다면 Next.js의 기본 빌드 명령어와 동일하므로 변경하지 않습니다.</p><h3 id="development-command"> <a class="anchor" href="#development-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>Development Command <a href="#development-command" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>사용할 일이 없다면 변경하지 않습니다.</p><h3 id="install-command"> <a class="anchor" href="#install-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install Command <a href="#install-command" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>패키지를 설치하기 위한 명령어로서 특별한 일이 없다면 변경하지 않습니다.</p><h3 id="output-directory"> <a class="anchor" href="#output-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Output Directory <a href="#output-directory" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>기본값은 <code class="language-plaintext highlighter-rouge">public</code>이며 만약 <code class="language-plaintext highlighter-rouge">public</code> 폴더가 없다면 현재 프로젝트를 가리킵니다.</p><ul><li>만약 배포하고자 하는 프로젝트가 정적 빌드를 이용한 정적 페이지 호스팅이라면 기본값으로 둬도 괜찮습니다.<li>서버사이드 렌더링 프로젝트라면 이 경로를 <code class="language-plaintext highlighter-rouge">.next</code>로 변경해야 합니다.</ul><h1 id="vercel-프로젝트-설정"> <a class="anchor" href="#vercel-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%84%A4%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vercel 프로젝트 설정</h1><p>CI/CD 설정을 위해 Vercel 관리 도구에서 설정해야 하는 몇가지 옵션이 존재합니다.</p><h2 id="개설한-프로젝트-진입하기"> <a class="anchor" href="#%EA%B0%9C%EC%84%A4%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%A7%84%EC%9E%85%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>개설한 프로젝트 진입하기 <a href="#개설한-프로젝트-진입하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-34-47.png" alt="Vercel 프로젝트 목록 화면" data-proofer-ignore> <em>Vercel 프로젝트 목록 화면</em></p><p><a href="https://vercel.com/">Vercel</a>에 접속 후 로그인을 진행하면 위와 같이 새로 추가한 프로젝트가 존재합니다.</p><p>해당 프로젝트를 눌러 상세 페이지에 진입하면 다음과 같은 화면이 보여집니다.</p><p><img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-35-05.png" alt="Vercel 프로젝트 상세 화면" data-proofer-ignore> <em>Vercel 프로젝트 상세 화면</em></p><h2 id="자동배포-차단하기"> <a class="anchor" href="#%EC%9E%90%EB%8F%99%EB%B0%B0%ED%8F%AC-%EC%B0%A8%EB%8B%A8%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>자동배포 차단하기 <a href="#자동배포-차단하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="자동-배포를-차단해야-하는-이유"> <a class="anchor" href="#%EC%9E%90%EB%8F%99-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%B0%A8%EB%8B%A8%ED%95%B4%EC%95%BC-%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0" aria-hidden="true"><span class="octicon octicon-link"></span></a>자동 배포를 차단해야 하는 이유 <a href="#자동-배포를-차단해야-하는-이유" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Vercel은 Git Repository와 연결 된 순간부터 Git의 커밋 내역을 바탕으로 자동 배포를 진행합니다.</p><p>자동 배포는 정말 간편하지만 일부 상황에서는 방해 요소로 작용합니다.</p><ul><li>빌드 완료 후 Slack 혹은 Discord Notification 전송<li>원하는 시점에 배포하도록 설정하고자 하는 경우<li>그 외 디테일한 추가 설정이 필요한 경우</ul><h3 id="방법"> <a class="anchor" href="#%EB%B0%A9%EB%B2%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>방법 <a href="#방법" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li>프로젝트 상단 [Settings] 탭을 클릭합니다.<li>Settings 페이지 좌측 네비게이션에서 [Git] 메뉴를 클릭합니다.<li>제일 아래로 내려보면 등장하는 [Ignored Build Step]을 확인합니다.<li>기본값이 [Automatic]으로 되어 있는데 이를 [Don’t build anything]으로 변경합니다.<li>[Save] 버튼을 누릅니다.<li>이제 어떤 브랜치에 새로운 히스토리가 푸쉬 되어도 배포가 진행 되지 않습니다. 🎉</ol><h2 id="staging-도메인-개설하기"> <a class="anchor" href="#staging-%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B0%9C%EC%84%A4%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Staging 도메인 개설하기 <a href="#staging-도메인-개설하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>프로젝트 상단 [Project] 탭을 클릭합니다.<li>프로젝트 제목 옆에 보이는 [Domains] 버튼을 클릭합니다.<li><p>Staging 서버로 연결 될 도메인을 입력하고 [Add] 버튼을 클릭합니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-41-23.png" alt="Domain 추가 화면" data-proofer-ignore></p><aside> ⚠️ 단, 여기서 사용할 수 있는 도메인은 Vercel 프로젝트와 연결 된 도메인이어야 합니다. 만약 내 소유의 도메인을 등록하고자 한다면 [도메인 인증과정](https://vercel.com/guides/why-is-my-vercel-domain-unverified)을 따르셔야 합니다. 그게 아니라면 기본 도메인의 원형을 따르는 도메인만 설정이 가능합니다. 원형: example.vercel.app 가능한 도메인: staging-example.vercel.app</aside><li><p>개설한 도메인의 상세 설정에서 Git Branch를 <code class="language-plaintext highlighter-rouge">master</code>나 <code class="language-plaintext highlighter-rouge">main</code>이 아닌 아무 브랜치로 설정합니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-41-47.png" alt="Domain 설정 화면" data-proofer-ignore></p><aside> ✅ Vercel의 기본 설정은 Git Repository의 히스토리와 브랜치 이름을 가지고 Production 여부를 판단하기 때문입니다.</aside></ol><h2 id="환경변수-설정하기"> <a class="anchor" href="#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>환경변수 설정하기 <a href="#환경변수-설정하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>프로젝트 내부에서 여러가지 이유로 <code class="language-plaintext highlighter-rouge">.env</code> 파일 안에 어떠한 값을 정의하여 사용하는 경우가 있습니다.</p><p>번들러가 번들링을 할 때 해당 <code class="language-plaintext highlighter-rouge">env</code> 변수를 읽어야 하므로 Vercel 프로젝트에 환경 변수를 정의하는 작업이 필요합니다.</p><ol><li>상단 [Settings] 탭을 클릭합니다.<li>좌측 [Environment Variables] 메뉴를 클릭합니다.<li>아래 사진의 영역에서 환경 변수를 설정하실 수 있습니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-42-08.png" alt="환경 변수 설정 화면" data-proofer-ignore><ul><li>환경 변수마다 어떤 빌드 상태일 때 불러올지 설정할 수 있습니다.<ul><li>production<li>preview<li>development</ul><li>환경 변수를 필드에 일일이 입력해도 되지만 기존에 작성 되어 있던 <code class="language-plaintext highlighter-rouge">.env</code> 파일을 해당 영역에 드래그 드롭하면 자동으로 입력 됩니다.</ul></ol><h1 id="github-workflow를-이용한-cicd"> <a class="anchor" href="#github-workflow%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-cicd" aria-hidden="true"><span class="octicon octicon-link"></span></a>Github Workflow를 이용한 CI/CD</h1><p>Vercel은 Git Repository 연결만으로 간편한 자동 배포를 지원하지만 Github Action을 이용하여 CI/CD를 작성하면 다음과 같은 이점이 있습니다.</p><ul><li>Slack, Discord와 같은 메신저에 Notification을 연결할 수 있습니다.<li>특정 버전을 선택하여 배포를 진행하는 등 커밋 히스토리에 기반한 배포 이외의 방법을 사용할 수 있습니다.<li>그 외 복잡한 사전/사후 프로세스를 진행할 수 있습니다. (유닛 테스트, e2e 테스트 등)</ul><h2 id="vercel-환경-변수-알아내기"> <a class="anchor" href="#vercel-%ED%99%98%EA%B2%BD-%EB%B3%80%EC%88%98-%EC%95%8C%EC%95%84%EB%82%B4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vercel 환경 변수 알아내기 <a href="#vercel-환경-변수-알아내기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>아래 배포 프로세스를 진행하기 위해서는 Vercel에서 얻을 수 있는 네 가지의 환경 변수가 필요합니다.</p><h3 id="organization-id"> <a class="anchor" href="#organization-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Organization ID <a href="#organization-id" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li> <a href="#vercel-cli%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%B6%94%EA%B0%80">개발 프로젝트와 Vercel 프로젝트를 서로 연결하는 과정을</a> 진행했다면 해당 프로젝트 폴더의 root에 <code class="language-plaintext highlighter-rouge">.vercel</code> 폴더가 생깁니다.<li> <code class="language-plaintext highlighter-rouge">.vercel/project.json</code> 파일을 열어보면 <code class="language-plaintext highlighter-rouge">orgId</code> 프로퍼티가 존재하는데, 이 값이 Organization ID입니다.</ol><h3 id="project-id"> <a class="anchor" href="#project-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project ID <a href="#project-id" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li> <a href="#vercel-cli%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%B6%94%EA%B0%80">개발 프로젝트와 Vercel 프로젝트를 서로 연결하는 과정을</a> 진행했다면 해당 프로젝트 폴더의 root에 <code class="language-plaintext highlighter-rouge">.vercel</code> 폴더가 생깁니다.<li> <code class="language-plaintext highlighter-rouge">.vercel/project.json</code> 파일을 열어보면 <code class="language-plaintext highlighter-rouge">projectId</code> 프로퍼티가 존재하는데, 이 값이 Project ID입니다.</ol><h3 id="token"> <a class="anchor" href="#token" aria-hidden="true"><span class="octicon octicon-link"></span></a>Token <a href="#token" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li> <a href="https://vercel.com">Vercel</a> 페이지로 접속합니다.<li>로그인 합니다.<li>우측 상단 프로필 이미지를 클릭합니다.<li>[Settings]를 클릭합니다.<li>좌측 메뉴에서 [Tokens]를 클릭합니다.<li>[Token Name] [Scope] [Expiration]을 입력하고 [Create] 버튼을 누릅니다.<ol><li>Scope는 반드시 배포를 진행할 프로젝트가 소속 된 조직으로 설정합니다.</ol><li>발급 된 Token을 사용합니다.<ol><li>한번 발급 된 Token은 <strong>어떠한 방법으로도 재열람이 불가능하니 반드시 다른 곳에 안전하게 보관해야 합니다.</strong></ol></ol><h3 id="team-id"> <a class="anchor" href="#team-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Team ID <a href="#team-id" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ol><li> <a href="https://vercel.com">Vercel</a> 페이지로 접속합니다.<li>로그인 합니다.<li>좌측 상단 조직명을 클릭합니다.<li>상단 [Settings]를 클릭합니다.<li>[General] 탭의 중간 쯤에 있는 Team ID를 복사합니다.</ol><h2 id="github-secret-key-등록하기"> <a class="anchor" href="#github-secret-key-%EB%93%B1%EB%A1%9D%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Github Secret Key 등록하기 <a href="#github-secret-key-등록하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>CI/CD를 진행하기 위해서는 위에서 얻은 여러 Key 값을 활용해야 합니다.</p><p>하지만 Key 값은 보안상 매우 엄중히 관리 되어야 하기 때문에 Repository에 그대로 노출 되는 <strong>Github Action에 평문으로 작성하면 보안상 심각한 이슈를 낳을 수 있습니다.</strong></p><p>그렇기에 Github는 보안상 민감한 Key를 별도의 저장소에 보관하고 관리할 수 있도록 Secret Variables 저장소를 지원합니다.</p><ol><li>Vercel에 배포할 프로젝트의 Github Repository에 진입합니다.<li>상단 [Settings] 탭을 클릭합니다.<li>좌측 메뉴 [Security] 항목의 [Secrets and variables] 탭을 클릭합니다.<li>하위의 [Actions] 탭을 클릭합니다.<li>[New repository secret] 버튼을 클릭합니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-55-01.png" alt="Secret 추가 화면" data-proofer-ignore><li>위에서 얻은 네 가지 Key를 다음의 이름으로 저장합니다.<ol><li>Organization ID → VERCEL_ORG_ID<li>Project ID → VERCEL_PROJECT_ID<li>Team ID → VERCEL_TEAM_ID<li>Token → VERCEL_TOKEN</ol><li>저장 했다면 다음과 같은 Secret Variables 목록을 보실 수 있습니다. <img data-src="/assets/post_images/2023-09-29-vercel-cicd/2023-09-30-00-55-25.png" alt="추가 된 Secret 목록" data-proofer-ignore></ol><h2 id="github-디렉토리-만들기"> <a class="anchor" href="#github-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>.github 디렉토리 만들기 <a href="#github-디렉토리-만들기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>프로젝트 Root 폴더에 <code class="language-plaintext highlighter-rouge">.github</code> 폴더를 만듭니다.<li> <code class="language-plaintext highlighter-rouge">.github</code> 폴더 안에 <code class="language-plaintext highlighter-rouge">workflows</code> 폴더를 만듭니다.</ol><h2 id="preview-배포-자동화-스크립트-작성하기"> <a class="anchor" href="#preview-%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preview 배포 자동화 스크립트 작성하기 <a href="#preview-배포-자동화-스크립트-작성하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>위에서 생성한 <code class="language-plaintext highlighter-rouge">.github/workflows</code> 폴더 안에 <code class="language-plaintext highlighter-rouge">vercel-preview-deploy.yaml</code> 파일을 생성합니다.<li><p>아래와 같이 스크립트를 작성합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre> <span class="na">name</span><span class="pi">:</span> <span class="s">Vercel Preview Deployment</span>
 <span class="na">env</span><span class="pi">:</span>
   <span class="na">VERCEL_ORG_ID</span><span class="pi">:</span> <span class="s">$</span>
   <span class="na">VERCEL_PROJECT_ID</span><span class="pi">:</span> <span class="s">$</span>
    
 <span class="na">on</span><span class="pi">:</span>
   <span class="na">push</span><span class="pi">:</span>
     <span class="na">branches</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s2">"</span><span class="s">develop"</span>
    
 <span class="na">jobs</span><span class="pi">:</span>
   <span class="na">Deploy-Preview</span><span class="pi">:</span>
     <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
     <span class="na">steps</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Vercel CLI</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">npm install --global vercel@latest</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Pull Vercel Environment Information</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">vercel pull --yes --environment=preview --token=$</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Project Artifacts</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">vercel build --token=$</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Assign beta domain</span>
         <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
           <span class="s">vercel deploy --prebuilt --token=$ &gt; domain.txt</span>
           <span class="s">vercel alias set `cat domain.txt` staging-logomakershop-biz.vercel.app --scope $ --token $</span>
</pre></table></code></div></div><li>원격 Repository에 푸쉬합니다.</ol><h2 id="preview-배포-스크립트-이해하기"> <a class="anchor" href="#preview-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preview 배포 스크립트 이해하기 <a href="#preview-배포-스크립트-이해하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>VERCEL 배포에 필요한 조직 ID와 PROJECT_ID를 설정합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="na">name</span><span class="pi">:</span> <span class="s">Vercel Preview Deployment</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">VERCEL_ORG_ID</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">VERCEL_PROJECT_ID</span><span class="pi">:</span> <span class="s">$</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">develop</code> 브랜치에 새로운 히스토리가 추가 되면 해당 Workflow가 작동합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="na">on</span><span class="pi">:</span>
    <span class="na">push</span><span class="pi">:</span>
      <span class="na">branches</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">develop"</span>
</pre></table></code></div></div><li><p>Ubuntu 가상머신을 통해 아래 프로세스를 수행합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="na">jobs</span><span class="pi">:</span>
    <span class="na">Deploy-Preview</span><span class="pi">:</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
</pre></table></code></div></div><ul><li>해당 프로세스의 이름을 <code class="language-plaintext highlighter-rouge">Deploy-Preview</code>라고 명명합니다.</ul><li><p>배포를 위한 Vercel 패키지를 설치합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Vercel CLI</span>
    <span class="na">run</span><span class="pi">:</span> <span class="s">npm install --global vercel@latest</span>
</pre></table></code></div></div><li>Vercel 설정값을 다운로드 합니다.<div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Pull Vercel Environment Information</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">vercel pull --yes --environment=preview --token=$</span>
</pre></table></code></div></div><ul><li>배포를 위한 인스턴스는 <code class="language-plaintext highlighter-rouge">.vercel</code> 파일이 없으므로 Vercel 설정값을 다운 받아야 합니다.<li> <code class="language-plaintext highlighter-rouge">--yes</code> 플래그는 해당 명령어에 대한 Confirm 여부를 모두 Yes로 설정합니다.</ul><li><p>프로젝트를 빌드합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Project Artifacts</span>
    <span class="na">run</span><span class="pi">:</span> <span class="s">vercel build --token=$</span>
</pre></table></code></div></div><li>새로운 Preview 버전을 생성하고 미리 생성해둔 staging 도메인을 별명으로 정합니다.<div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Assign beta domain</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">vercel deploy --prebuilt --token=$ &gt; domain.txt</span>
        <span class="s">vercel alias set `cat domain.txt` staging-logomakershop-biz.vercel.app --scope $ --token $</span>
</pre></table></code></div></div><ul><li> <code class="language-plaintext highlighter-rouge">vercel deploy --prebuilt</code> 명령어를 이용하여 Preview 배포를 실행합니다.<li> <code class="language-plaintext highlighter-rouge">vercel deploy --prebuilt</code> 명령어는 새롭게 발급 된 도메인을 Output으로 반환합니다.<li>새로 발급 된 도메인을 <code class="language-plaintext highlighter-rouge">domain.txt</code> 파일에 저장합니다.<li> <code class="language-plaintext highlighter-rouge">vercel alias set</code> 명령어로 <code class="language-plaintext highlighter-rouge">domain.txt</code> 파일에 저장 된 도메인을 Staging 도메인에도 연결합니다.</ul></ul><h3 id="-왜-alias가-필요한가요"> <a class="anchor" href="#-%EC%99%9C-alias%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C%EA%B0%80%EC%9A%94" aria-hidden="true"><span class="octicon octicon-link"></span></a>❓ 왜 alias가 필요한가요? <a href="#-왜-alias가-필요한가요" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><a href="#preview">위에서 언급 했듯</a>이 Preview는 매번 새로운 도메인을 생성하여 배포합니다.</p><p>매번 새로운 도메인을 생성하게 되면 고정 된 URL이 필요한 여러 상황에서 방해가 됩니다.</p><ul><li>Preview 확인이 필요한 내부 관계자에게 최신 Preview 주소를 매번 고지 해줘야 합니다.<li>Cognito와 같이 Redirect URI를 입력 해야 이용할 수 있는 서드파티 솔루션을 사용할 수 없습니다.</ul><p>위와 같은 이유로 언제나 최신 Preview를 유지하는 고정 된 도메인이 필요합니다.</p><h2 id="production-배포-자동화-스크립트-작성하기"> <a class="anchor" href="#production-%EB%B0%B0%ED%8F%AC-%EC%9E%90%EB%8F%99%ED%99%94-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Production 배포 자동화 스크립트 작성하기 <a href="#production-배포-자동화-스크립트-작성하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li> <code class="language-plaintext highlighter-rouge">.github/workflows</code> 폴더에 <code class="language-plaintext highlighter-rouge">vercel-product-deploy.yaml</code> 파일을 생성합니다.<li><p>해당 파일에 다음과 같이 스크립트를 작성합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre> <span class="na">name</span><span class="pi">:</span> <span class="s">Vercel Production Deployment</span>
 <span class="na">env</span><span class="pi">:</span>
   <span class="na">VERCEL_ORG_ID</span><span class="pi">:</span> <span class="s">$</span>
   <span class="na">VERCEL_PROJECT_ID</span><span class="pi">:</span> <span class="s">$</span>
    
 <span class="na">on</span><span class="pi">:</span>
   <span class="na">push</span><span class="pi">:</span>
     <span class="na">branches</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s2">"</span><span class="s">master"</span> <span class="c1"># or main</span>
    
 <span class="na">jobs</span><span class="pi">:</span>
   <span class="na">Deploy-Production</span><span class="pi">:</span>
     <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
     <span class="na">steps</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Vercel CLI</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">npm install --global vercel@latest</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Pull Vercel Environment Information</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">vercel pull --yes --environment=production --token=$</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Project Artifacts</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">vercel build --prod --token=$</span>
       <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy Project Artifacts to Vercel</span>
         <span class="na">run</span><span class="pi">:</span> <span class="s">vercel deploy --prebuilt --prod --token=$</span>
</pre></table></code></div></div></ol><h2 id="production-배포-스크립트-이해하기"> <a class="anchor" href="#production-%EB%B0%B0%ED%8F%AC-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>Production 배포 스크립트 이해하기 <a href="#production-배포-스크립트-이해하기" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>Vercel 프로젝트에 대한 설정을 진행합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="na">name</span><span class="pi">:</span> <span class="s">Vercel Production Deployment</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">VERCEL_ORG_ID</span><span class="pi">:</span> <span class="s">$</span>
    <span class="na">VERCEL_PROJECT_ID</span><span class="pi">:</span> <span class="s">$</span>
</pre></table></code></div></div><li><p><code class="language-plaintext highlighter-rouge">master</code> 브랜치에 새로운 히스토리가 푸쉬 되면 해당 Workflow가 동작합니다.</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>  <span class="na">on</span><span class="pi">:</span>
    <span class="na">push</span><span class="pi">:</span>
      <span class="na">branches</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">master"</span> <span class="c1"># or main</span>
</pre></table></code></div></div><li>Ubuntu 가상머신을 통해 아래 프로세스를 실행합니다.<div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="na">jobs</span><span class="pi">:</span>
    <span class="na">Deploy-Production</span><span class="pi">:</span>
      <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
</pre></table></code></div></div><li>Vercel 배포를 위한 CLI 패키지를 npm에서 설치합니다.<div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Vercel CLI</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">npm install --global vercel@latest</span>
</pre></table></code></div></div><li>Vercel 설정을 다운로드 합니다.<div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>    
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Pull Vercel Environment Information</span>
    <span class="na">run</span><span class="pi">:</span> <span class="s">vercel pull --yes --environment=preview --token=$</span>
</pre></table></code></div></div><li>빌드 합니다. ```yaml<ul><li>name: Build Project Artifacts run: vercel build –prod –token=$ ```<li> <code class="language-plaintext highlighter-rouge">--prod</code> 플래그를 활용하면 Production 모드로 빌드합니다.</ul><li>배포를 진행합니다.</ul><h1 id="마치며"> <a class="anchor" href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>마치며</h1><p>이번 문서에서는 이렇게 Next.js와 Vercel 그리고 Github Workflow를 활용한 배포 자동화를 진행해봤습니다 🎉<br> 제가 처음 연동을 진행했을 때 겪었던 모든 트러블을 상세히 작성하느라 다소 분량 조절에 실패한 듯한 느낌이 들지만 이 문서 하나로 다른 많은 개발자분들이 시간을 아낄 수 있다고 생각하면 이보다 보람찬 일도 또 없을 것 같습니다.<br> 다음번에는 Slack Bot을 이용하여 유관자들에게 배포 상태에 대한 알림을 자동으로 보내주는 방법도 기재할 예정이오니 많은 관심 부탁드립니다 🙇</p></div><applause-button class="mb6" color=rgb(79,177,186) url=https://univdev.github.io/posts/vercel-cicd/ > </applause-button><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>Tech</a>, <a href='/categories/talk/'>Talk</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/vercel/" class="post-tag no-text-decoration" >Vercel</a> <a href="/tags/next-js/" class="post-tag no-text-decoration" >Next.js</a> <a href="/tags/cicd/" class="post-tag no-text-decoration" >CICD</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화 - Univdev&url=https://univdev.github.io/posts/vercel-cicd/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화 - Univdev&u=https://univdev.github.io/posts/vercel-cicd/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Next.js + Vercel + Github Workflow를 결합한 가장 아름다운 배포 자동화 - Univdev&url=https://univdev.github.io/posts/vercel-cicd/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div><div class="giscus-frame" style="margin-top: 24px"><div class="giscus"></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/adapter-pattern/">서버와 클라이언트의 우아한(?) 대화 방법, Adapter Pattern (Feat. FSD)</a><li><a href="/posts/experience-teacher/">프로그래밍 교육을 진행해보며 느낀점 (멘토 활동 중간 회고)</a><li><a href="/posts/my-first-npm-library/">우아한 나의 패키지, ww-timer 회고</a><li><a href="/posts/2024-seoul-comicworld-ssul/">2024 서울 코믹월드 부스 참여한 썰 풉니다</a><li><a href="/posts/focuskeeper-renewal/">Focus Keeper 랜딩 페이지 런칭 후기 (부제: UX가 프로덕트 성공에 미치는 영향)</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/react-native/">React Native</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/tech/">Tech</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/next-js/">Next.js</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/talk/">Talk</a> <a class="post-tag" href="/tags/vue/">Vue</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rotate-objects/"><div class="card-body"> <em class="timeago small" date="2023-01-16 17:00:00 +0800" >2023년 01월 16일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>도형의 각도를 회전하는 방법</h3><div class="text-muted small"><p> 들어가며 이미지 편집 서비스 Canva 다중 오브젝트를 한 번에 회전 시키려고 하면 오브젝트의 각도와 위치가 동시에 변경 됩니다. 본 문서에서는 위 기능을 구현하는 방법에 대해 기술합니다. 회전 각도 구하기 우선 두 점 사이의 각도를 구하는 함수에 대해 정의 합니다. interface Point { x: number; y: number; }...</p></div></div></a></div><div class="card"> <a href="/posts/nextjs-hydration/"><div class="card-body"> <em class="timeago small" date="2022-11-03 09:53:00 +0800" >2022년 11월 03일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nextjs의 hydration이란?</h3><div class="text-muted small"><p> Hydration Hydration을 검색하면 나오는 이미지 Hydration은 위 이미지처럼 ‘수분 공급’을 의미합니다. Hydration을 이해하기 전에 CSR, SSR이 무엇인지 간단하게 짚고 넘어가야 합니다. CSR Client Side Rendering의 약자입니다. Web은 단순히 홈페이지라는 개념을 넘어서 응용프로그램의 영역을 대체한지 ...</p></div></div></a></div><div class="card"> <a href="/posts/nextjs-portal/"><div class="card-body"> <em class="timeago small" date="2022-11-03 09:53:00 +0800" >2022년 11월 03일</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nextjs에서 React Portal 사용해보기</h3><div class="text-muted small"><p> React Portal 웹을 제작하다보면 대부분의 경우 계층 구조로 컴포넌트를 배치하여 렌더링하는 방식으로 문제를 해결할 수 있습니다. 그런데 간혹 n레벨에 배치 되어야 하는 컴포넌트가 실제로 렌더링 될 때는 Document의 최상단에 배치하고 싶을 수 있습니다. Tooltip Modal Tooltip이나 Modal 컴포넌트가 바로 그 대표적인...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/good-taxonomy-architecture/" class="btn btn-outline-primary" prompt="이전 글"><p>Taxonomy 대응을 위한 좋은 아키텍처</p></a> <a href="/posts/workflow-slack-notification/" class="btn btn-outline-primary" prompt="다음 글"><p>가장 아름다운 배포 자동화, 근데 이제 Slack을 곁들인</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/username">Univdev</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/react-native/">React Native</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/tech/">Tech</a> <a class="post-tag" href="/tags/jekyll/">Jekyll</a> <a class="post-tag" href="/tags/next-js/">Next.js</a> <a class="post-tag" href="/tags/javascript/">Javascript</a> <a class="post-tag" href="/tags/talk/">Talk</a> <a class="post-tag" href="/tags/vue/">Vue</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-YG0J6JPJH8"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-YG0J6JPJH8'); }); </script> <script type="module"> // Import the functions you need from the SDKs you need import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js"; import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-analytics.js"; // TODO: Add SDKs for Firebase products that you want to use // https://firebase.google.com/docs/web/setup#available-libraries // Your web app's Firebase configuration // For Firebase JS SDK v7.20.0 and later, measurementId is optional const firebaseConfig = { apiKey: "AIzaSyBJNPjzcl0MfmOnqKAPv_DxEKE9BTtXatQ", authDomain: "univdev-github-io.firebaseapp.com", projectId: "univdev-github-io", storageBucket: "univdev-github-io.appspot.com", messagingSenderId: "259575315621", appId: "1:259575315621:web:c6a4b474e982f56f65a14c", measurementId: "G-Z60972D1V1" }; // Initialize Firebase const app = initializeApp(firebaseConfig); const analytics = getAnalytics(app); </script>
